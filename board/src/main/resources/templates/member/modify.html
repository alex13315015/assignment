<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<div layout:fragment="content" class="main">
    <div class="container">
        <h2>정보수정</h2>
        <form action="/member/modify" method="post">
        <table class="table">
            <tbody>
            <tr>
                <th scope="row">아이디</th>
                <td th:text="${#authentication.principal.loggedMember.id}"></td>
            </tr>
            <tr>
                <th scope="row">이름</th>
                <td>
                    <input th:type="text" name="name" th:value="${#authentication.principal.loggedMember.name}">
                </td>
            </tr>
            <tr>
                <th scope="row">이메일</th>
                <td>
                    <input th:type="text" name="email" th:value="${#authentication.principal.loggedMember.email}">
                </td>
            </tr>
            <tr>
                <th scope="row">패스워드</th>
                <td><input th:type="password" name="password"></td>
            </tr>
            </tbody>
        </table>
            <input type="hidden" name="id" th:value="${#authentication.principal.loggedMember.id}">
            <div class="d-flex justify-content-center mt-3">
                <button class="btn btn-dark">확인</button>
                <button class="btn btn-dark mx-2" id="btnModify">ajax확인</button>
            </div>
        </form>
        <div class="mt-5" th:if="${error}">
            <p class="alert alert-danger" th:text="${exception}">패스워드를 확인해주세요.</p>
        </div>
    </div>
    <script>
        $("#btnModify").on("click",function (e) {
            //console.log("click");
            const sendData = $("form").serialize();
            $.ajax({
                url:"/member/modify",
                method:"PUT",
               /* data: {
                    id:$("input[name='id']").val(),
                    password:$("input[name = 'password']").val(),
                    name:$("input[name = 'name']").val(),
                    email:$("input[name = 'email']").val()
                },*/
                data:sendData,
                success:function (data) {
                    if(data.isState === "success") {
                        location.href = "/";
                    }else {
                        alert("패스워드를 확인해주세요.")
                    }
                }
            });
            return false;
        })
    </script>
</div>

</html>