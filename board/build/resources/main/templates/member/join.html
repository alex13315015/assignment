<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<div layout:fragment="content" class="main">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-6">
                <h2 class="mt-5 mb-5">회원가입</h2>
                    <form action="" th:action="@{/member/join}" th:object="${memberDto}" method="post">
                        <div th:if="${#fields.hasGlobalErrors()}">
                            <th:block th:each="item:${#fields.globalErrors()}">
                            <p class="fieldError" th:text="${item}">너 살아는 있냐?</p>
                            </th:block>
                        </div>
                        <div class="row g-3 align-items-center">
                            <div class="col-auto">
                                <label for="id" class="col-form-label">아이디</label>
                            </div>
                            <div class="col-auto ">
                                <input type="text" id="id" name="id" class="form-control" aria-describedby="passwordHelpInline">
                                <div class="error" th:if="${#fields.hasErrors('id')}" th:errors="*{id}"> 오류 메시지..</div>
                            </div>
                        </div>
                        <div class="row g-3 align-items-center mt-3">
                            <div class="col-auto">
                                <label for="password" class="col-form-label">패스워드</label>
                            </div>
                            <div class="col-auto">
                                <input type="password" id="password" name="password" class="form-control" aria-describedby="passwordHelpInline">
                                <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"> 오류 메시지..</div>
                            </div>
                        </div>
                        <div class="row g-3 align-items-center mt-3">
                            <div class="col-auto">
                                <label for="name" class="col-form-label">이름</label>
                            </div>
                            <div class="col-auto">
                                <input type="text" id="name" name="name" class="form-control" aria-describedby="passwordHelpInline">
                                <div class="error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"> 오류 메시지..</div>
                            </div>
                        </div>
                        <div class="row g-3 align-items-center mt-3">
                            <div class="col-auto">
                                <label for="email" class="col-form-label">이메일</label>
                            </div>
                            <div class="col-auto">
                                <input type="text" id="email" name="email" class="form-control" aria-describedby="passwordHelpInline">
                                <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"> 오류 메시지..</div>
                            </div>
                        </div>
                        <div class="mb-3 mt-3">
                            <button class="btn btn-dark" id="btnSend">인증번호 받기</button>
                        </div>
                        <div class="mb-3" id="emailConfirm" style="display: none">
                            <label for="email" class="form-label">이메일 인증</label>
                            <input type="text" class="form-control" placeholder="abcde@email.com" id="confirmNum">
                            <button class="btn btn-dark mt-3" type="button" id="btnConfirm">이메일 인증하기</button>
                        </div>
                        <div class="d-flex justify-content-center mt-5">
                            <button class="btn btn-dark">확인</button>
                        </div>
                    </form>
            </div>
        </div>
    </div>
    <script>
        let isAuth = false;
        let confirmNum = 0;
        $("#btnSend").on("click",function () {
            //key,value로 날아감!!
            $("#emailConfirm").show();
            $.ajax({
                url: "/mail/confirm",
                method: "post",
                data: {mail:$("#email").val()},
                success:function (result) {
                    alert("인증메일이 발송되었습니다.");
                    confirmNum = result.confirmNumber;
                    console.log(result);
                }

            });
            return false;
        });
        $("#btnConfirm").on("click",function () {
            if(confirmNum === ($("#confirmNum").val())) {
                alert("이메일 인증을 완료했습니다.");
                isAuth = true;
            } else {
                alert("인증번호를 확인해주세요.");
            }
        });
        $("#btnJoinConfirm").on("click",function () {
            if(isAuth) {
                $("form").submit();
            }
            alert("메일 인증은 필수입니다.");
            return false;
        })

        /*$("#point").on("keyup",function (e) {
            console.log($(this).val());
            const pointValue = $(this).val();
            const regEx = /[^0-9].[^0-9]/g;
            const replacePointValue = pointValue.replace(regEx,"");
            $(this).val(replacePointValue);
        })*/
    </script>
</div>


</html>